路由技术是Internet得以持续运转的关键所在。路由是极其有趣而又复杂的课题，永远的话题。

企业网络的拓扑结构一般会比较复杂，不同的部门，或者总部和分支可能处在不同的网络中，此时就需要使用路由器来连接不同的网络，实现网络之间的数据转发。

常用名词：

<table>
<colgroup>
<col style="width: 49%" />
<col style="width: 50%" />
</colgroup>
<thead>
<tr class="header">
<th>术语</th>
<th>备注</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><p>路由</p>
<p>routing</p></td>
<td><p>从源地址到目的地址</p>
<p>不同网络间的转发过程</p></td>
</tr>
<tr class="even">
<td><p>路由表</p>
<p>routing table</p></td>
<td><p>路由信息的集合</p>
<p> 路由的依据</p></td>
</tr>
<tr class="odd">
<td>路由器 router</td>
<td>具有路由功能的设备</td>
</tr>
<tr class="even">
<td>默认网关default gateway</td>
<td>通过是路由设备的接口IP地址</td>
</tr>
</tbody>
</table>

路由过程图解：
![image2](D:\note\HCIA\resources/7489231156ac4b6eb094fede0a2061f1.jpg)
路由器收到数据包检测路由表中是否存在能够去往目的IP地址
转发过程中是逐跳转发“并不会引导其他路由器转发”
数据通信是”双向性“

![image3](D:\note\HCIA\resources/deafa56cb6564b0eaf480839a02b1abe.jpg)

![image4](D:\note\HCIA\resources/d4406f7ca6a54086bd4bd994a025f874.jpg)
路由表只是转发的依据，真正转发的是根据接口“知道从哪里发送”
下一跳是路由器需要将该数据包交给谁来转发

![image5](D:\note\HCIA\resources/4b0d81c037ca4475bfbcccf13efaa771.jpg)

路由协议分为动态协议和静态协议
静态的配置简单，不占用资源
动态协议配置相对复杂，可以及时同步网络变化

IP路由表：存放最优的路由信息/条目
![image6](D:\note\HCIA\resources/88815a28b20d48138b171230e8c5b759.jpg)
路由表包含了可以去往的目的网络 ，路由器收到目的网络不存在的会直接丢弃

| 路由表字段 | 备注 |
|----|----|
| Destination目标地址 | **用来标识存在的能够去往的目的地址或目的网络** |
| Mask掩码 | **用来选择最佳路由的重要依据（最长匹配原则）** |
| NextHop下一跳 | **指明该数据包所经过的下一个路由器的接口地址** |
| Interface出接口 | **指明该数据包将从哪个接口转发** |
| Protocol 协议 | **路由的来源（学习方式）** |
| Preference优先级 | **用来比较不同协议学习去往相同地址不同路径的优先程度（越小越优先）** |
| cost开销 | **用来比较相同协议学习去往相同地址不同路径的的代价（越小越优先）** |

![image7](D:\note\HCIA\resources/9c9feb7899a64c9f8d9af1c551ac746d.jpg)
不同协议比较

| 路由协议/类型   | Direct | OSPF | ISIS | Static | RIP | OSPF ASE | BGP |
|-----------------|--------|------|------|--------|-----|----------|-----|
| 管理距离/优先级 | 0     | 10  | 15   | 60     | 100 | 150      | 255 |

![image8](D:\note\HCIA\resources/f1823601fc014cbca11a3d3229371a39.jpg)
相同协议比较

等价路由（ECMP，Equal cost multi-Path）：
对于一个路由来源，当到同一个目标网络存在多条相同度量值的路由时，路由器会将这些路由条目都加入路由表，数据包会在这几个链路（路径）进行负载分担。
![image9](D:\note\HCIA\resources/9f46064735d54c47975738f169ebfe18.jpg)

![image10](D:\note\HCIA\resources/b76871897ae54c8f97485792fe2f002f.jpg)
（负载均衡的选择：逐包，逐流 可以根据目标IP或源IP，目标MAC或源MAC选择。最终会经过“哈希”计算实现）

最长掩码匹配原则：最终数据包实现最佳路由的算法
![image11](D:\note\HCIA\resources/530ee731e34e4cc3939343de4f90fda0.jpg)
以该图为例
![image12](D:\note\HCIA\resources/c1c51e26e39c45c688bcf3e4c4637482.jpg)
路由器的转发原则如下：将所有的路由条目进行与计算，得出最长的相同掩码来转发
目标地址9.1.2.1，路由器转发过程：
首先与计算目标地址得出:0000 1001.0000 0001.0000 0010.0000 0001

0.0.0.0/0 掩码为0，表示任意目标地址都行
00000000.0000 0000.0000 0000.0000 0000
00001001.0000 0001.0000 0010.0000 0001
匹配出4位相同 ✔

8.0.0.0/8 掩码为8，表示只有目的地址前8位一致才行
0000 1000.0000 0000.0000 0000.0000 0000
0000 1001.0000 0001.0000 0010.0000 0001 ❌

9.0.0.0/8 掩码为8，表示只有目的地址前8位一致才行
0000 1001.0000 0000.0000 0000.0000 0000
00001001.0000 0001.0000 0010.0000 0001
匹配出8位相同 ✔

9.1.0.0/16 掩码为16，表示只有目的地址前16位一致才行
0000 1001.0000 0000.0000 0000.0000 0000
0000 1001.0000 0001.0000 0010.0000 0001
匹配出15位相同 ✔

拿出 0.0.0.0/0 ❌
9.0.0.0/8 ❌
9.1.0.0/16 ✔

![image13](D:\note\HCIA\resources/196e59c29c7c405eb378ca101d2ee5c5.jpg)
路由表的形成，路由的来源：
| 路由来源 | 备注                                            |
|----------|-------------------------------------------------|
| 直连路由 | 路由器接口上的网络 （接口配置IP地址并且UP出现） |
| 静态路由 | 管理员手动添加的网络                            |
| 动态路由 | 路由器之间运行某些协议学习到的网络              |
